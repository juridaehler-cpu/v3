<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Meme Galerie</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: auto; }
    #gallery img { margin: 5px; border-radius: 8px; }
    #controls { margin-top: 10px; }
    #uploadSection { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Login / Registrierung</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Passwort">
  <div id="controls">
    <button id="registerBtn">Registrieren</button>
    <button id="loginBtn">Login</button>
    <button id="logoutBtn" style="display:none;">Logout</button>
    <button id="uploadToggleBtn" style="display:none;">➕</button>
  </div>
  <p id="status">Nicht eingeloggt</p>

  <div id="uploadSection">
    <h3>Foto hochladen</h3>
    <input type="file" id="fileInput">
    <button id="uploadBtn">Hochladen</button>
  </div>

  <h2>Galerie</h2>
  <div id="gallery"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
    import { 
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
    import { 
      getStorage, ref, uploadBytes, getDownloadURL 
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";
    import { 
      getFirestore, collection, addDoc, onSnapshot 
    } from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";

    // ⬇️ Deine Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCquaWxIaakG_KH3gdULBWQ5AqnOlcNWkk",
      authDomain: "backend-website-825cd.firebaseapp.com",
      projectId: "backend-website-825cd",
      storageBucket: "backend-website-825cd.appspot.com",
      messagingSenderId: "255366578644",
      appId: "1:255366578644:web:277fa35b90e10b03311641",
      measurementId: "G-5PJGM3D79G"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const storage = getStorage(app);
    const db = getFirestore(app);

    const statusEl = document.getElementById("status");
    const logoutBtn = document.getElementById("logoutBtn");
    const uploadToggleBtn = document.getElementById("uploadToggleBtn");
    const uploadSection = document.getElementById("uploadSection");

    // Auth-Status überwachen
    onAuthStateChanged(auth, (user) => {
      if (user) {
        statusEl.innerText = `Eingeloggt als ${user.email}`;
        logoutBtn.style.display = "inline-block";
        uploadToggleBtn.style.display = "inline-block";
      } else {
        statusEl.innerText = "Nicht eingeloggt";
        logoutBtn.style.display = "none";
        uploadToggleBtn.style.display = "none";
        uploadSection.style.display = "none";
      }
    });

    // Registrierung
    document.getElementById("registerBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      await createUserWithEmailAndPassword(auth, email, pass);
      alert("Konto erstellt!");
    };

    // Login
    document.getElementById("loginBtn").onclick = async () => {
      const email = document.getElementById("email").value;
      const pass = document.getElementById("password").value;
      await signInWithEmailAndPassword(auth, email, pass);
      alert("Login erfolgreich!");
    };

    // Logout
    logoutBtn.onclick = async () => {
      await signOut(auth);
    };

    // Upload-Bereich ein-/ausblenden
    uploadToggleBtn.onclick = () => {
      uploadSection.style.display = 
        uploadSection.style.display === "none" ? "block" : "none";
    };

    // Foto hochladen
    document.getElementById("uploadBtn").onclick = async () => {
      const file = document.getElementById("fileInput").files[0];
      if (!file) return alert("Bitte zuerst ein Bild auswählen!");
      const storageRef = ref(storage, "images/" + Date.now() + "_" + file.name);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);
      await addDoc(collection(db, "photos"), { url });
      alert("Foto hochgeladen!");
    };

    // Galerie in Echtzeit laden
    const gallery = document.getElementById("gallery");
    onSnapshot(collection(db, "photos"), (snapshot) => {
      gallery.innerHTML = "";
      snapshot.forEach((doc) => {
        const img = document.createElement("img");
        img.src = doc.data().url;
        img.width = 200;
        gallery.appendChild(img);
      });
    });
  </script>
</body>
</html>

